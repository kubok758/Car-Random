<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0b0b0b">
    <meta name="description" content="Ultimate Car Randomizer App">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>ULTIMATE CAR RANDOMIZER</title>
    <style>
        :root {
            --bg-color: #0b0b0b;
            --card: #141414;
            --text: #e0e0e0;
            --eco: #00ff9d;
            --mid: #00eaff;
            --pre: #d600ff;
            --lux: #ffbd00;
            --mat: #ff0040;
        }

        html { height: 100%; width: 100%; overflow: hidden; }
        body {
            background-color: var(--bg-color);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: scroll;
            color: var(--text);
            font-family: 'Arial Black', 'Impact', sans-serif;
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            height: 100%; width: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            margin: 0; padding: 0;
            overflow: hidden; overscroll-behavior: none;
            touch-action: none; user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.5s ease;
        }
        body::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); z-index: -1; pointer-events: none;
        }

        .wrapper {
            width: 90%; max-width: 600px; padding: 20px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            position: relative; z-index: 10;
        }

        .settings-bar { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000; }
        @supports (padding-top: env(safe-area-inset-top)) { .settings-bar { top: calc(20px + env(safe-area-inset-top)); } }

        .icon-btn {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff; width: 45px; height: 45px; border-radius: 50%;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(10px); padding: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }
        .icon-btn svg { width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .icon-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }
        .icon-btn.off { opacity: 0.5; border-color: #444; color: #888; background: rgba(0,0,0,0.8); }
        .icon-btn.active { background: rgba(255, 255, 255, 0.9); color: #000; box-shadow: 0 0 15px rgba(255, 255, 255, 0.5); }
        .slash { display: none; }
        .icon-btn.off .slash { display: block; }

        #bgMenu {
            display: none; position: absolute; top: 80px; right: 20px; width: 260px;
            background: rgba(20, 20, 20, 0.95); border: 1px solid #444; border-radius: 15px;
            padding: 15px; z-index: 1001; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            backdrop-filter: blur(10px); text-align: left;
        }
        @supports (padding-top: env(safe-area-inset-top)) { #bgMenu { top: calc(80px + env(safe-area-inset-top)); } }
        #bgMenu h3 { margin: 0 0 10px 0; font-size: 0.9rem; color: #888; text-transform: uppercase; font-family: 'Segoe UI', sans-serif; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .bg-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .bg-btn { width: 100%; aspect-ratio: 1; border-radius: 8px; border: 2px solid rgba(255,255,255,0.1); cursor: pointer; transition: transform 0.2s; position: relative; overflow: hidden; }
        .bg-btn:hover { border-color: #fff; } .bg-btn:active { transform: scale(0.9); }
        .c-black { background: #0b0b0b; } .c-gray { background: #2d2d2d; } .c-blue { background: #0f1c2e; } .c-red { background: #2e0f0f; }
        .img-merc { background: url('mercedes.jpg') center/cover; } .img-bmw { background: url('bmw.jpg') center/cover; } .img-porsche { background: url('porsche.jpg') center/cover; }
        .mobile-wallpapers { display: none; }
        @media (max-width: 768px) { .mobile-wallpapers { display: block; } }

        h1 {
            font-size: 1.8rem; text-transform: uppercase; letter-spacing: 4px;
            color: #fff; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            margin-bottom: 30px; line-height: 1.2; width: 100%;
        }
        .output-box {
            background: rgba(20, 20, 20, 0.85); border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 20px; width: 100%; position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); transition: 0.1s transform, 0.3s border-color, 0.3s box-shadow;
            cursor: pointer; min-height: 180px; display: flex; flex-direction: column;
            justify-content: center; align-items: center; backdrop-filter: blur(10px);
        }
        .output-box:active { transform: scale(0.98); }
        #carName {
            font-size: 1.8rem; line-height: 1.2; text-transform: uppercase;
            background: -webkit-linear-gradient(#fff, #aaa); -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
            margin-bottom: 10px; word-break: break-word;
        }
        #tierLabel { font-family: 'Segoe UI', sans-serif; font-size: 0.8rem; letter-spacing: 3px; color: #999; font-weight: 700; text-transform: uppercase; }
        .controls { width: 100%; display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .btn {
            background: #fff; color: #000; border: none; padding: 20px 0; width: 100%;
            font-size: 1.4rem; font-weight: 900; text-transform: uppercase; border-radius: 12px;
            cursor: pointer; transition: 0.1s; box-shadow: 0 0 20px rgba(255,255,255,0.1);
        }
        .btn:active { transform: translateY(2px); background: #ddd; } .btn:disabled { background: #333; color: #555; box-shadow: none; }
        #googleBtn {
            display: none; background: rgba(0,0,0,0.6); color: #aaa; border: 2px solid rgba(255,255,255,0.2);
            padding: 15px 0; width: 100%; font-size: 1rem; font-weight: 700; text-transform: uppercase;
            border-radius: 8px; cursor: pointer; transition: 0.2s; font-family: 'Segoe UI', sans-serif;
            letter-spacing: 1px; align-items: center; justify-content: center; gap: 10px;
        }
        #googleBtn svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; }
        #googleBtn:hover { border-color: #fff; color: #fff; background: rgba(0,0,0,0.8); }
        #googleBtn:active { transform: scale(0.98); }

        .glow-eco { border-color: var(--eco); box-shadow: 0 0 40px rgba(0,255,157,0.15); }
        .glow-eco #carName { background: -webkit-linear-gradient(#fff, var(--eco)); -webkit-background-clip: text; }
        .glow-mid { border-color: var(--mid); box-shadow: 0 0 50px rgba(0,234,255,0.2); }
        .glow-mid #carName { background: -webkit-linear-gradient(#fff, var(--mid)); -webkit-background-clip: text; }
        .glow-pre { border-color: var(--pre); box-shadow: 0 0 60px rgba(214,0,255,0.25); }
        .glow-pre #carName { background: -webkit-linear-gradient(#fff, var(--pre)); -webkit-background-clip: text; }
        .glow-lux { border-color: var(--lux); box-shadow: 0 0 80px rgba(255,189,0,0.3); }
        .glow-lux #carName { background: -webkit-linear-gradient(#fff, var(--lux)); -webkit-background-clip: text; }
        .glow-mat { border-color: var(--mat); box-shadow: 0 0 80px rgba(255, 0, 64, 0.6); }
        .glow-mat #carName { background: -webkit-linear-gradient(#fff, var(--mat)); -webkit-background-clip: text; }

        #cheatPanel { display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #000; border: 2px solid red; padding: 10px; z-index: 2000; box-shadow: 0 0 30px rgba(255,0,0,0.5); width: 80%; max-width: 400px; text-align: center; border-radius: 10px; }
        .cheat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 5px; }
        .cheat-btn { padding: 10px; cursor: pointer; font-weight: bold; border:none; font-size: 0.8rem; border-radius: 5px; }
    </style>
</head>
<body>

<div class="settings-bar">
    <button class="icon-btn" id="fastToggle" onclick="toggleFast()"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg></button>
    <button class="icon-btn" id="bgToggle" onclick="toggleBgMenu()"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg></button>
    <button class="icon-btn" id="vibroToggle" onclick="toggleVibro()"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect x="10" y="4" width="4" height="16" rx="2"></rect><path d="M7 8 L6 8"></path><path d="M7 12 L6 12"></path><path d="M7 16 L6 16"></path><path d="M17 8 L18 8"></path><path d="M17 12 L18 12"></path><path d="M17 16 L18 16"></path><line x1="3" y1="3" x2="21" y2="21" class="slash" stroke="#888"></line></svg></button>
    <button class="icon-btn" id="soundToggle" onclick="toggleSound()"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path><line x1="23" y1="9" x2="17" y2="15" class="slash" stroke="#888"></line><line x1="17" y1="9" x2="23" y2="15" class="slash" stroke="#888"></line></svg></button>
</div>

<div id="bgMenu">
    <h3>Цвета</h3>
    <div class="bg-grid">
        <div class="bg-btn c-black" onclick="setBgColor('#0b0b0b')"></div>
        <div class="bg-btn c-gray" onclick="setBgColor('#2d2d2d')"></div>
        <div class="bg-btn c-blue" onclick="setBgColor('#0f1c2e')"></div>
        <div class="bg-btn c-red" onclick="setBgColor('#2e0f0f')"></div>
    </div>
    <div class="mobile-wallpapers">
        <h3>Обои</h3>
        <div class="bg-grid">
            <div class="bg-btn img-merc" onclick="setBgImage('mercedes.jpg')"></div>
            <div class="bg-btn img-bmw" onclick="setBgImage('bmw.jpg')"></div>
            <div class="bg-btn img-porsche" onclick="setBgImage('porsche.jpg')"></div>
        </div>
    </div>
</div>

<div id="cheatPanel">
    <div style="color:red; font-size:10px; font-weight:bold">АДМИН ПАНЕЛЬ</div>
    <div class="cheat-grid" style="grid-template-columns: 1fr 1fr;">
        <button class="cheat-btn" style="background:var(--eco)" onclick="activateCheat('economy')">ЭКО</button>
        <button class="cheat-btn" style="background:var(--mid)" onclick="activateCheat('middle')">СРЕД</button>
        <button class="cheat-btn" style="background:var(--pre); color:white" onclick="activateCheat('premium')">ПРЕМ</button>
        <button class="cheat-btn" style="background:var(--lux)" onclick="activateCheat('luxury')">ЛЮКС</button>
        <button class="cheat-btn" style="background:var(--mat); color:white; grid-column: span 2" onclick="activateCheat('matmall')">MAT-MALL</button>
    </div>
</div>

<div class="wrapper">
    <h1>Car Randomizer</h1>
    <div class="output-box" id="box">
        <div id="carName">ГОТОВО</div>
        <div id="tierLabel">НАЖМИ КНОПКУ</div>
    </div>
    <div class="controls">
        <button class="btn" id="spinBtn" onclick="spin()">КРУТИТЬ</button>
        <button id="googleBtn" onclick="openGoogle()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
            ПОСМОТРЕТЬ ФОТО
        </button>
    </div>
</div>

<script>
    if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('sw.js').catch(err => console.log('SW Fail:', err)); }); }

    // === UI ===
    function toggleBgMenu() { const m = document.getElementById('bgMenu'); m.style.display = (m.style.display === 'block') ? 'none' : 'block'; }
    document.addEventListener('click', (e) => { const m = document.getElementById('bgMenu'), b = document.getElementById('bgToggle'); if (!m.contains(e.target) && !b.contains(e.target)) m.style.display = 'none'; });
    function setBgColor(c) { document.body.style.backgroundImage = 'none'; document.body.style.backgroundColor = c; document.getElementById('bgMenu').style.display = 'none'; localStorage.setItem('carApp_bgType', 'color'); localStorage.setItem('carApp_bgValue', c); }
    function setBgImage(f) { document.body.style.backgroundColor = '#0b0b0b'; document.body.style.backgroundImage = `url('${f}')`; document.getElementById('bgMenu').style.display = 'none'; localStorage.setItem('carApp_bgType', 'image'); localStorage.setItem('carApp_bgValue', f); }

    // === SETTINGS ===
    let audioCtx=null, isSoundOn=true, isVibroOn=true, isFastSpin=false;
    function initAudio() { if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==='suspended') audioCtx.resume(); }
    function playClickSound() {
        if(!isSoundOn||!audioCtx)return; const o=audioCtx.createOscillator(),g=audioCtx.createGain();
        o.connect(g); g.connect(audioCtx.destination); o.type='triangle'; 
        o.frequency.setValueAtTime(800,audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(1200,audioCtx.currentTime+0.05);
        g.gain.setValueAtTime(0.3,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.05);
        o.start(); o.stop(audioCtx.currentTime+0.05);
    }
    function toggleSound() { isSoundOn=!isSoundOn; document.getElementById('soundToggle').classList.toggle('off',!isSoundOn); localStorage.setItem('carApp_sound',isSoundOn); initAudio(); }
    function toggleVibro() { isVibroOn=!isVibroOn; document.getElementById('vibroToggle').classList.toggle('off',!isVibroOn); localStorage.setItem('carApp_vibro',isVibroOn); }
    function toggleFast() { isFastSpin=!isFastSpin; document.getElementById('fastToggle').classList.toggle('active',isFastSpin); localStorage.setItem('carApp_fast',isFastSpin); }
    function doVibrate(p) { if(isVibroOn&&navigator.vibrate) try{navigator.vibrate(p);}catch(e){} }
    
    function initSettings() {
        if(localStorage.getItem('carApp_sound')==='false'){ isSoundOn=false; document.getElementById('soundToggle').classList.add('off'); }
        if(localStorage.getItem('carApp_vibro')==='false'){ isVibroOn=false; document.getElementById('vibroToggle').classList.add('off'); }
        if(localStorage.getItem('carApp_fast')==='true'){ isFastSpin=true; document.getElementById('fastToggle').classList.add('active'); }
        const t=localStorage.getItem('carApp_bgType'), v=localStorage.getItem('carApp_bgValue');
        if(t==='color'&&v){ document.body.style.backgroundImage='none'; document.body.style.backgroundColor=v; }
        else if(t==='image'&&v){ document.body.style.backgroundColor='#0b0b0b'; document.body.style.backgroundImage=`url('${v}')`; }
    }

    // === GENERATOR: MASSIVE DATABASE ===
    const r = (arr) => arr[Math.floor(Math.random() * arr.length)];
    
    function genMatMall() { return "Porsche Cayenne Coupe Turbo GT"; }

    function genEconomy() {
        const pool = [
            "Lada Priora Sedan", 
            "Lada Priora Hatchback", 
            "Lada Priora Coupe", 
            "Lada Priora 2",
            "Lada Vesta NG", 
            "Lada Vesta SW Cross", 
            "Lada Vesta Sport", 
            "Lada Vesta 1.8",
            "Lada Granta Drive Active", 
            "Lada Granta Sport", 
            "Lada Granta FL", 
            "Lada Granta Cross",
            "Lada 2114 Super-Avto", 
            "Lada 2114 1.6", 
            "Lada 2113", 
            "Lada 2112 Coupe", 
            "Lada 2107", 
            "Lada 2106", 
            "Lada 4x4 Niva Legend",
            "Volkswagen Polo Sedan", 
            "Volkswagen Polo GT", 
            "Volkswagen Polo Liftback", 
            "Skoda Rapid 1.4 TSI", 
            "Skoda Rapid 1.6 MPI", 
            "Skoda Rapid Monte Carlo",
            "Skoda Octavia A5 1.6 MPI", 
            "Skoda Octavia A7 1.6 MPI", 
            "Skoda Fabia RS",
            "Hyundai Solaris 1.6 MT", 
            "Hyundai Solaris 1.6 AT", 
            "Hyundai Solaris Restyling",
            "Kia Rio 3", 
            "Kia Rio 4", 
            "Kia Rio X-Line", 
            "Kia Cerato 2", 
            "Hyundai Elantra HD",
            "Toyota Corolla 120", 
            "Toyota Corolla 150", 
            "Toyota Carina E", 
            "Toyota Caldina",
            "Honda Civic EK3", 
            "Honda Civic EK9", 
            "Honda Civic ES", 
            "Honda Civic 4D", 
            "Honda Civic 5D", 
            "Honda Fit RS",
            "Mazda 3 BK", 
            "Mazda 3 BL", 
            "Mazda 3 BM", 
            "Mazda 6 GG",
            "Mitsubishi Lancer 9", 
            "Mitsubishi Lancer X 1.8", 
            "Mitsubishi Lancer X 2.0",
            "Haval M6", 
            "Haval Jolion Comfort", 
            "Haval Jolion Elite", 
            "Haval Jolion Premium",
            "Chery Tiggo 4 Pro", 
            "Chery Tiggo 4",
            "Geely Emgrand", 
            "Geely Coolray Comfort",
            "Omoda S5", 
            "Omoda S5 GT",
            "Kaiyi E5", 
            "BAIC U5 Plus", 
            "JAC J7",
            "Changan Alsvin", 
            "Changan Eado Plus",
            "Livan X3 Pro", 
            "Moskvich 3"
        ];
        return r(pool);
    }
    
    function genMiddle() {
        const pool = [
            "Toyota Mark II JZX90 Grande", "Toyota Mark II JZX90 Tourer V", "Toyota Mark II JZX100 Tourer V", "Toyota Mark II JZX110 iR-V",
            "Toyota Chaser JZX100 Tourer V", "Toyota Chaser JZX100 Avante G", 
            "Toyota Cresta JZX90", "Toyota Cresta JZX100 Roulant G",
            "Toyota Crown S170 Athlete", "Toyota Crown S170 Majesta", "Toyota Crown S180 Athlete", "Toyota Crown S200 Royal Saloon", "Toyota Crown S210 Athlete",
            "Toyota Camry XV40 3.5", "Toyota Camry XV50 3.5", "Toyota Camry XV55 2.5", "Toyota Camry XV70 3.5 V6",
            "Toyota Altezza RS200", "Toyota Aristo V300", "Toyota Soarer JZZ30",
            "Toyota RAV4 XA50 Hybrid", "Toyota Land Cruiser Prado 150",
            "Nissan Silvia S13", "Nissan Silvia S14", "Nissan Silvia S15 Spec-R",
            "Nissan Skyline R32 GTS-T", "Nissan Skyline R33 GTS-T", "Nissan Skyline R34 GT-T",
            "Nissan Laurel C33", "Nissan Laurel C34", "Nissan Laurel C35 Club-S",
            "Nissan Teana J31", "Nissan Teana J32 3.5", "Nissan Fuga",
            "Subaru Impreza WRX STI GC8", "Subaru Impreza WRX STI GDB Peanut", "Subaru Impreza WRX STI GDB Blobeye", "Subaru Impreza WRX STI GDB Hawkeye", "Subaru Impreza WRX STI GRB",
            "Subaru Forester SF5 STI", "Subaru Forester SG9 STI", "Subaru Legacy B4",
            "Honda Accord CL7 Euro-R", "Honda Accord CL9", "Honda Accord CU2 Type-S", 
            "Honda Civic Type-R EP3", "Honda Civic Type-R FN2", "Honda Civic Type-R FD2", "Honda Integra DC5 Type-R",
            "Haval F7x Tech Plus", "Haval F7 Premium", "Haval Dargo Tech Plus", "Haval Dargo X", "Haval H9 Premium", "Haval H3",
            "Geely Coolray Flagship Sport", "Geely Atlas Pro 4WD", "Geely Tugella Flagship Sport", "Geely Preface",
            "Chery Tiggo 7 Pro Max AWD", "Chery Tiggo 8 Pro Max New", "Chery Arrizo 8 Ultimate",
            "Omoda C5 AWD Supreme", "Jaecoo J7 Supreme",
            "Tank 300 City Premium", "Tank 300 Offroad",
            "Jetour Dashing Luxury", "Jetour T2 Expedition"
        ];
        return r(pool);
    }
    
    function genPremium() {
        const pool = [
            "BMW E30 325i", "BMW E34 525i", "BMW E34 540i", "BMW E34 M5 3.8",
            "BMW E36 328i", "BMW E36 M3", "BMW E38 740i", "BMW E38 750iL",
            "BMW E39 530d", "BMW E39 540i", "BMW E39 M5",
            "BMW E46 330Ci", "BMW E46 M3", "BMW E46 M3 CSL",
            "BMW E53 X5 4.4i", "BMW E53 X5 4.8is",
            "BMW E60 530d", "BMW E60 535d", "BMW E60 550i", "BMW E60 M5",
            "BMW E92 335i", "BMW E92 M3",
            "BMW F10 530d", "BMW F10 550i", "BMW F10 M5", "BMW F10 M550d",
            "BMW F30 340i", "BMW F80 M3", "BMW F82 M4",
            "BMW F90 M5", "BMW F90 M5 Competition", "BMW F90 M5 CS",
            "BMW G20 M340i", "BMW G80 M3 Competition", "BMW G82 M4 CSL",
            "BMW G30 540i", "BMW G11 740d", "BMW G12 M760Li",
            "BMW X5 M50d (F15)", "BMW X5M (F85)", "BMW X5 G05 40i", "BMW X5M Competition (F95)", "BMW X7 M60i", "BMW XM",
            "Mercedes 190E Evo II", "Mercedes W124 E500", 
            "Mercedes W140 S500", "Mercedes W140 S600",
            "Mercedes W210 E55 AMG", "Mercedes W211 E55 AMG", "Mercedes W211 E63 AMG",
            "Mercedes W204 C63 AMG", "Mercedes W204 C63 AMG Black Series",
            "Mercedes W205 C63 S AMG", "Mercedes W212 E63 AMG S", "Mercedes W213 E63 S AMG",
            "Mercedes W222 S500", "Mercedes W222 S63 AMG", "Mercedes W222 Maybach",
            "Mercedes W223 S580", "Mercedes GT63 S AMG 4-Door",
            "Mercedes G55 AMG", "Mercedes G63 AMG (W463)", "Mercedes G63 AMG (W464)",
            "Mercedes GLE 63 S AMG Coupe", "Mercedes GLS 600 Maybach",
            "Audi S2 Coupe", "Audi RS2 Avant",
            "Audi RS4 B5", "Audi RS4 B7", "Audi RS4 B9 Avant",
            "Audi RS5 Coupe", "Audi RS6 C5", "Audi RS6 C6 V10", "Audi RS6 C7 Performance", "Audi RS6 C8 Avant",
            "Audi RS7 Sportback C7", "Audi RS7 C8",
            "Audi S8 D2", "Audi S8 D4", "Audi S8 D5",
            "Audi R8 V8", "Audi R8 V10 Plus", "Audi R8 V10 Performance",
            "Audi Q7 V12 TDI", "Audi SQ8", "Audi RS Q8",
            "Porsche Cayenne Turbo GT", "Porsche Cayenne Coupe", "Porsche Macan GTS", "Porsche Panamera Turbo S",
            "Range Rover Autobiography", "Range Rover Sport SVR",
            "Lexus IS-F", "Lexus GS-F", "Lexus LC500", "Lexus LX570", "Lexus LX600",
            "Zeekr 001 YOU", "Zeekr 001 ME", "Zeekr 001 FR", "Zeekr 009", "Zeekr X", "Zeekr 007",
            "Li Auto L7 Ultra", "Li Auto L9 Ultra", "Li Auto L9 Max", "Li Auto L6",
            "Geely Monjaro Exclusive", "Voyah Free EVR", "Voyah Dream", "Voyah Passion",
            "Tank 500 Urban", "Tank 500 Premium", "Tank 700 Hi4-T",
            "Exeed VX President", "Exeed RX", "Avatr 11", "Avatr 12", "HiPhi Z", "HiPhi X",
            "Lotus Eletre R", "YangWang U8"
        ];
        return r(pool);
    }
    
    function genLuxury() {
        const pool = [
            "Ferrari F40", "Ferrari Enzo", "Ferrari LaFerrari", "Ferrari 458 Italia", "Ferrari 488 Pista", 
            "Ferrari F8 Tributo", "Ferrari 812 Superfast", "Ferrari 812 Competizione", "Ferrari SF90 Stradale", 
            "Ferrari 296 GTB", "Ferrari Daytona SP3", "Ferrari Purosangue",
            "Lamborghini Diablo VT", "Lamborghini Murcielago SV", "Lamborghini Aventador LP700-4", "Lamborghini Aventador SVJ", 
            "Lamborghini Huracan Performante", "Lamborghini Huracan STO", "Lamborghini Revuelto", 
            "Lamborghini Urus", "Lamborghini Urus Performante", "Lamborghini Sesto Elemento", "Lamborghini Veneno",
            "Porsche Carrera GT", "Porsche 918 Spyder", 
            "Porsche 911 Turbo S (992)", "Porsche 911 GT3 RS (992)", "Porsche 911 GT2 RS (991)",
            "Bugatti Veyron 16.4", "Bugatti Veyron Super Sport", "Bugatti Chiron", "Bugatti Chiron Super Sport 300+", 
            "Bugatti Divo", "Bugatti Bolide", "Bugatti Mistral", "Bugatti Tourbillon",
            "McLaren F1", "McLaren P1", "McLaren Senna", "McLaren 720S", "McLaren 765LT", "McLaren Speedtail",
            "Koenigsegg Agera RS", "Koenigsegg One:1", "Koenigsegg Jesko Absolut", "Koenigsegg Gemera",
            "Pagani Zonda Cinque", "Pagani Huayra BC", "Pagani Utopia",
            "Rimac Nevera", "SSC Tuatara", "Hennessey Venom F5",
            "Rolls-Royce Phantom", "Rolls-Royce Ghost", "Rolls-Royce Wraith", "Rolls-Royce Cullinan", "Rolls-Royce Spectre", "Rolls-Royce Boat Tail",
            "Bentley Continental GT Speed", "Bentley Flying Spur Mulliner", "Bentley Bentayga Speed", "Bentley Bacalar",
            "YangWang U9", "Hongqi E-HS9 Executive", "Hongqi H9+", "HiPhi A"
        ];
        return r(pool);
    }

    // === MAIN LOGIC ===
    let cheatNext = null;
    let currentCar = "";
    let clicks = 0;
    let timer;

    const carNameEl = document.getElementById('carName');
    const tierLabelEl = document.getElementById('tierLabel');
    const box = document.getElementById('box');
    const spinBtn = document.getElementById('spinBtn');
    const googleBtn = document.getElementById('googleBtn');
    const cheatPanel = document.getElementById('cheatPanel');

    document.addEventListener('DOMContentLoaded', initSettings);

    box.addEventListener('click', () => {
        clicks++;
        clearTimeout(timer);
        timer = setTimeout(() => clicks = 0, 400);
        if (clicks === 10) {
            clicks = 0;
            doVibrate(50);
            if (prompt("КОД ДОСТУПА:") === "758") cheatPanel.style.display = 'grid';
        }
    });

    function activateCheat(tier) {
        cheatNext = tier;
        cheatPanel.style.display = 'none';
        doVibrate([50, 50]);
        alert("Следующая: " + tier.toUpperCase());
    }

    function openGoogle() {
        if (!currentCar) return;
        const query = encodeURIComponent(currentCar);
        window.open(`https://www.google.com/search?tbm=isch&q=${query}`, '_blank');
    }

    function spin() {
        if (spinBtn.disabled) return;
        
        initAudio();
        spinBtn.disabled = true;
        googleBtn.style.display = 'none';
        
        box.className = 'output-box'; 
        carNameEl.style.opacity = 0.5;
        tierLabelEl.innerText = "ПОИСК...";

        if (isFastSpin) {
            playClickSound();
            doVibrate([20]);
            finalize();
            return;
        }

        let speed = 50;
        let steps = 0;
        const maxSteps = 20 + Math.floor(Math.random() * 10);

        function tick() {
            const funcs = [genEconomy, genMiddle, genPremium, genLuxury];
            carNameEl.innerText = funcs[Math.floor(Math.random()*funcs.length)]();
            
            playClickSound();
            doVibrate(5); 

            steps++;
            if (steps < maxSteps) {
                if(steps > maxSteps - 5) speed += 30;
                setTimeout(tick, speed);
            } else {
                finalize();
            }
        }
        tick();
    }

    function finalize() {
        let tier;
        if (cheatNext) {
            tier = cheatNext;
            cheatNext = null;
        } else {
            // Шансы:
            // 1% - Mat-Mall
            // 99% / 4 = 24.75% на остальные
            const rand = Math.random();
            
            if (rand < 0.01) {
                tier = 'matmall';
            } else if (rand < 0.2575) {
                tier = 'economy';
            } else if (rand < 0.505) {
                tier = 'middle';
            } else if (rand < 0.7525) {
                tier = 'premium';
            } else {
                tier = 'luxury';
            }
        }

        let resultName = "";
        let label = "";
        let glowClass = "";

        if (tier === 'matmall') {
            resultName = genMatMall();
            label = "РЕДКОСТЬ: MAT-MALLОВСКАЯ";
            glowClass = 'glow-mat';
        } else if (tier === 'economy') {
            resultName = genEconomy();
            label = "КЛАСС 1: ЭКОНОМ / СТОК";
            glowClass = 'glow-eco';
        } else if (tier === 'middle') {
            resultName = genMiddle();
            label = "КЛАСС 2: СРЕДНИЙ / JDM / SUV"; // Исправленное название
            glowClass = 'glow-mid';
        } else if (tier === 'premium') {
            resultName = genPremium();
            label = "КЛАСС 3: ПРЕМИУМ / СПОРТ";
            glowClass = 'glow-pre';
        } else {
            resultName = genLuxury();
            label = "КЛАСС 4: ЭКЗОТИКА / ЛЮКС";
            glowClass = 'glow-lux';
        }

        currentCar = resultName;
        carNameEl.innerText = resultName;
        carNameEl.style.opacity = 1;
        tierLabelEl.innerText = label;
        box.classList.add(glowClass);
        spinBtn.disabled = false;
        
        googleBtn.style.display = 'flex'; 

        doVibrate([30, 50, 30]); 
    }
</script>

</body>
</html>
