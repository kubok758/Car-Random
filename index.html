<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0b0b0b">
    <meta name="description" content="Ultimate Car Randomizer App">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>ULTIMATE CAR RANDOMIZER</title>
    <style>
        :root {
            --bg-color: #0b0b0b;
            --card: #141414;
            --text: #e0e0e0;
            --eco: #00ff9d;
            --mid: #00eaff;
            --pre: #d600ff;
            --lux: #ffbd00;
        }

        body {
            background-color: var(--bg-color);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: var(--text);
            font-family: 'Arial Black', 'Impact', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
            touch-action: manipulation; 
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.5s ease;
        }

        /* Затемнение для читаемости на фоне картинок */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
            pointer-events: none;
        }

        .wrapper {
            width: 100%;
            max-width: 700px;
            text-align: center;
            position: relative;
            padding: 20px;
            box-sizing: border-box;
        }

        /* === ВЕРХНИЕ КНОПКИ (SETTINGS) === */
        .settings-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 200;
        }

        .icon-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            padding: 0;
        }

        .icon-btn svg {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .icon-btn:active { transform: scale(0.9); }
        
        /* Состояние выключено */
        .icon-btn.off {
            opacity: 0.5;
            border-color: #444;
            color: #888;
            background: rgba(0,0,0,0.5);
        }
        
        .slash { display: none; }
        .icon-btn.off .slash { display: block; }

        /* === МЕНЮ ВЫБОРА ФОНА === */
        #bgMenu {
            display: none;
            position: fixed;
            top: 80px;
            right: 20px;
            width: 260px;
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid #444;
            border-radius: 15px;
            padding: 15px;
            z-index: 300;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            text-align: left;
        }

        #bgMenu h3 {
            margin: 0 0 10px 0;
            font-size: 0.9rem;
            color: #888;
            text-transform: uppercase;
            font-family: 'Segoe UI', sans-serif;
            letter-spacing: 1px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        .bg-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .bg-btn {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }
        .bg-btn:hover { border-color: #fff; }
        .bg-btn:active { transform: scale(0.9); }

        /* Цвета */
        .c-black { background: #0b0b0b; }
        .c-gray { background: #2d2d2d; }
        .c-blue { background: #0f1c2e; }
        .c-red { background: #2e0f0f; }

        /* Обои (файлы должны лежать рядом с index.html) */
        .img-merc { background: url('mercedes.jpg') center/cover; }
        .img-bmw { background: url('bmw.jpg') center/cover; }
        .img-porsche { background: url('porsche.jpg') center/cover; }

        /* Скрываем картинки на ПК, показываем на мобильных */
        .mobile-wallpapers { display: none; }
        @media (max-width: 768px) { .mobile-wallpapers { display: block; } }

        /* === ОСНОВНОЙ ИНТЕРФЕЙС === */
        h1 {
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            margin-bottom: 30px;
            margin-top: 50px;
        }

        .output-box {
            background: rgba(20, 20, 20, 0.85);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 40px 15px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            transition: 0.1s transform, 0.3s border-color, 0.3s box-shadow;
            cursor: pointer;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .output-box:active { transform: scale(0.98); }

        #carName {
            font-size: 2rem;
            line-height: 1.1;
            text-transform: uppercase;
            background: -webkit-linear-gradient(#fff, #aaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
            margin-bottom: 10px;
        }

        #tierLabel {
            font-family: 'Segoe UI', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 3px;
            color: #888;
            font-weight: 700;
            text-transform: uppercase;
        }

        .controls { display: flex; flex-direction: column; gap: 15px; }

        .btn {
            background: #fff;
            color: #000;
            border: none;
            padding: 20px 0;
            width: 100%;
            font-size: 1.4rem;
            font-weight: 900;
            text-transform: uppercase;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.1s;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
        }
        .btn:active { transform: translateY(2px); background: #ddd; }
        .btn:disabled { background: #333; color: #555; transform: none; box-shadow: none;}

        #googleBtn {
            display: none;
            background: rgba(0,0,0,0.6);
            color: #aaa;
            border: 2px solid rgba(255,255,255,0.2);
            padding: 15px 0;
            width: 100%;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'Segoe UI', sans-serif;
            letter-spacing: 1px;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        #googleBtn svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; }
        #googleBtn:hover { border-color: #fff; color: #fff; background: rgba(0,0,0,0.8); }
        #googleBtn:active { transform: scale(0.98); }

        /* Подсветка */
        .glow-eco { border-color: var(--eco); box-shadow: 0 0 40px rgba(0,255,157,0.15); }
        .glow-eco #carName { background: -webkit-linear-gradient(#fff, var(--eco)); -webkit-background-clip: text; }
        .glow-mid { border-color: var(--mid); box-shadow: 0 0 50px rgba(0,234,255,0.2); }
        .glow-mid #carName { background: -webkit-linear-gradient(#fff, var(--mid)); -webkit-background-clip: text; }
        .glow-pre { border-color: var(--pre); box-shadow: 0 0 60px rgba(214,0,255,0.25); }
        .glow-pre #carName { background: -webkit-linear-gradient(#fff, var(--pre)); -webkit-background-clip: text; }
        .glow-lux { border-color: var(--lux); box-shadow: 0 0 80px rgba(255,189,0,0.3); }
        .glow-lux #carName { background: -webkit-linear-gradient(#fff, var(--lux)); -webkit-background-clip: text; }

        /* Админка */
        #cheatPanel {
            display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #000; border: 2px solid red; padding: 10px; z-index: 500;
            box-shadow: 0 0 30px rgba(255,0,0,0.5); width: 80%; max-width: 400px; text-align: center;
        }
        .cheat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 5px; }
        .cheat-btn { padding: 15px; cursor: pointer; font-weight: bold; border:none; font-size: 1rem; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="settings-bar">
        <button class="icon-btn" id="bgToggle" onclick="toggleBgMenu()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>
        </button>
        <button class="icon-btn" id="vibroToggle" onclick="toggleVibro()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <rect x="10" y="4" width="4" height="16" rx="2"></rect>
                <path d="M7 8 L6 8"></path><path d="M7 12 L6 12"></path><path d="M7 16 L6 16"></path>
                <path d="M17 8 L18 8"></path><path d="M17 12 L18 12"></path><path d="M17 16 L18 16"></path>
                <line x1="3" y1="3" x2="21" y2="21" class="slash" stroke="#888"></line>
            </svg>
        </button>
        <button class="icon-btn" id="soundToggle" onclick="toggleSound()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                <line x1="23" y1="9" x2="17" y2="15" class="slash" stroke="#888"></line>
                <line x1="17" y1="9" x2="23" y2="15" class="slash" stroke="#888"></line>
            </svg>
        </button>
    </div>

    <div id="bgMenu">
        <h3>Цвета</h3>
        <div class="bg-grid">
            <div class="bg-btn c-black" onclick="setBgColor('#0b0b0b')"></div>
            <div class="bg-btn c-gray" onclick="setBgColor('#2d2d2d')"></div>
            <div class="bg-btn c-blue" onclick="setBgColor('#0f1c2e')"></div>
            <div class="bg-btn c-red" onclick="setBgColor('#2e0f0f')"></div>
        </div>
        <div class="mobile-wallpapers">
            <h3>Обои</h3>
            <div class="bg-grid">
                <div class="bg-btn img-merc" onclick="setBgImage('mercedes.jpg')"></div>
                <div class="bg-btn img-bmw" onclick="setBgImage('bmw.jpg')"></div>
                <div class="bg-btn img-porsche" onclick="setBgImage('porsche.jpg')"></div>
            </div>
        </div>
    </div>

    <div id="cheatPanel">
        <div style="color:red; font-size:10px; font-weight:bold">АДМИН ПАНЕЛЬ</div>
        <div class="cheat-grid">
            <button class="cheat-btn" style="background:var(--eco)" onclick="activateCheat('economy')">ЭКО</button>
            <button class="cheat-btn" style="background:var(--mid)" onclick="activateCheat('middle')">СРЕД</button>
            <button class="cheat-btn" style="background:var(--pre); color:white" onclick="activateCheat('premium')">ПРЕМ</button>
            <button class="cheat-btn" style="background:var(--lux)" onclick="activateCheat('luxury')">ЛЮКС</button>
        </div>
    </div>

    <h1>Car Randomizer</h1>

    <div class="output-box" id="box">
        <div id="carName">ГОТОВО</div>
        <div id="tierLabel">НАЖМИ КНОПКУ</div>
    </div>

    <div class="controls">
        <button class="btn" id="spinBtn" onclick="spin()">КРУТИТЬ</button>
        <button id="googleBtn" onclick="openGoogle()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
            ПОСМОТРЕТЬ ФОТО
        </button>
    </div>
</div>

<script>
    // PWA Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW Registered!', reg.scope))
                .catch(err => console.log('SW Fail:', err));
        });
    }

    // === ЛОГИКА ФОНОВ ===
    function toggleBgMenu() {
        const menu = document.getElementById('bgMenu');
        menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
    }
    document.addEventListener('click', (e) => {
        const menu = document.getElementById('bgMenu');
        const btn = document.getElementById('bgToggle');
        if (!menu.contains(e.target) && !btn.contains(e.target)) menu.style.display = 'none';
    });
    function setBgColor(c) { document.body.style.backgroundImage = 'none'; document.body.style.backgroundColor = c; document.getElementById('bgMenu').style.display = 'none'; }
    function setBgImage(f) { document.body.style.backgroundColor = '#0b0b0b'; document.body.style.backgroundImage = `url('${f}')`; document.getElementById('bgMenu').style.display = 'none'; }

    // === АУДИО (Web Audio API) ===
    let audioCtx = null;
    let isSoundOn = true;
    let isVibroOn = true;

    function initAudio() {
        if (!audioCtx) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    function playClickSound() {
        if (!isSoundOn || !audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        
        // Звук щелчка (короткий и резкий)
        osc.type = 'triangle'; 
        osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
        osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.05);
        
        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
        
        osc.start();
        osc.stop(audioCtx.currentTime + 0.05);
    }

    function toggleSound() {
        isSoundOn = !isSoundOn;
        const btn = document.getElementById('soundToggle');
        if(!isSoundOn) btn.classList.add('off'); else btn.classList.remove('off');
        initAudio();
    }

    function toggleVibro() {
        isVibroOn = !isVibroOn;
        const btn = document.getElementById('vibroToggle');
        if(!isVibroOn) btn.classList.add('off'); else btn.classList.remove('off');
    }

    function doVibrate(pattern) {
        if (isVibroOn && navigator.vibrate) {
            try { navigator.vibrate(pattern); } catch(e){}
        }
    }

    // === ГЕНЕРАТОР МАШИН (ПОЛНАЯ БАЗА) ===
    const r = (arr) => arr[Math.floor(Math.random() * arr.length)];

    function genEconomy() {
        const pool = [
            () => `Lada Priora ${r(['Sedan', 'Hatchback', 'Coupe'])}`,
            () => `Lada Vesta ${r(['NG', 'SW Cross', 'Sport', '1.8'])}`,
            () => `Lada Granta ${r(['Drive Active', 'Sport', 'FL'])}`,
            () => `Lada 2114 ${r(['Super-Avto', '1.6'])}`,
            () => `Volkswagen Polo ${r(['Sedan', 'GT', 'Liftback'])}`,
            () => `Skoda Rapid ${r(['1.4 TSI', '1.6 MPI', 'Monte Carlo'])}`,
            () => `Skoda Octavia ${r(['A5', 'A7', 'A8'])} 1.6 MPI`,
            () => `Hyundai Solaris ${r(['1.6 MT', '1.6 AT', 'Restyling'])}`,
            () => `Kia Rio ${r(['3', '4', 'X-Line'])}`,
            () => `Toyota Corolla ${r(['120', '150'])}`,
            () => `Honda Civic ${r(['EK3', 'EK9', 'ES', '4D', '5D'])}`,
            () => `Mazda 3 ${r(['BK', 'BL', 'BM'])}`,
            () => `Mitsubishi Lancer ${r(['9', 'X 1.8', 'X 2.0'])}`
        ];
        return r(pool)();
    }

    function genMiddle() {
        const brands = {
            toyota: [
                { model: "Mark II", chassis: ["JZX90", "JZX100", "JZX110"], trims: ["Grande", "Tourer S", "Tourer V", "iR-V"] },
                { model: "Chaser", chassis: ["JZX100", "JZX90"], trims: ["Tourer V", "Avante G"] },
                { model: "Cresta", chassis: ["JZX90", "JZX100"], trims: ["Roulant G", "Super Lucent"] },
                { model: "Crown", chassis: ["S170", "S180", "S200", "S210"], trims: ["Athlete", "Majesta", "Royal Saloon"] },
                { model: "Camry", chassis: ["XV40", "XV50", "XV55", "XV70"], trims: ["3.5 V6", "2.5", "Hybrid"] },
                { model: "Altezza", chassis: ["SXE10"], trims: ["RS200", "AS200"] }
            ],
            nissan: [
                { model: "Silvia", chassis: ["S13", "S14", "S15"], trims: ["Spec-R", "Spec-S", "Q's", "K's"] },
                { model: "Skyline", chassis: ["R32", "R33", "R34"], trims: ["GTS-T", "GT-T", "Sedan"] },
                { model: "Laurel", chassis: ["C33", "C34", "C35"], trims: ["Club-S", "Medalist"] },
                { model: "Teana", chassis: ["J31", "J32"], trims: ["3.5 V6", "2.5"] }
            ],
            subaru: [
                { model: "Impreza WRX STI", chassis: ["GC8", "GDB Peanut", "GDB Blobeye", "GDB Hawkeye", "GRB", "VA"], trims: [""] },
                { model: "Forester", chassis: ["SF5", "SG5", "SG9", "SH"], trims: ["STI", "Cross Sports", "XT"] }
            ],
            honda: [
                { model: "Accord", chassis: ["CL7", "CL9", "CU2", "CV"], trims: ["Euro-R", "Type-S", "2.4"] },
                { model: "Civic", chassis: ["Type-R EP3", "Type-R FN2", "Type-R FD2"], trims: [""] }
            ]
        };
        const brandKey = r(Object.keys(brands));
        const car = r(brands[brandKey]);
        const chassis = r(car.chassis);
        const trim = r(car.trims);
        const brandName = brandKey.charAt(0).toUpperCase() + brandKey.slice(1);
        return `${brandName} ${car.model} ${chassis} ${trim}`;
    }

    function genPremium() {
        const germans = [
            { 
                brand: "BMW", 
                configs: [
                    { ch: "E36", eng: ["318is", "320i", "325i", "328i", "M3"] },
                    { ch: "E46", eng: ["320i", "325i", "330Ci", "330d", "M3", "M3 CSL"] },
                    { ch: "E92", eng: ["320i", "325i", "330d", "335i", "M3"] },
                    { ch: "F30", eng: ["320d", "328i", "330i", "335i", "340i"] },
                    { ch: "F80", eng: ["M3", "M3 Competition", "M3 CS"] },
                    { ch: "G20", eng: ["320d", "330i", "M340i"] },
                    { ch: "G80", eng: ["M3", "M3 Competition"] },
                    { ch: "E34", eng: ["525i", "530i", "540i", "M5 3.8"] },
                    { ch: "E39", eng: ["525i", "530d", "540i", "M5"] },
                    { ch: "E60", eng: ["525i", "530d", "535d", "545i", "550i", "M5"] },
                    { ch: "F10", eng: ["520d", "528i", "530d", "535i", "550i", "M550d", "M5"] },
                    { ch: "F90", eng: ["M5", "M5 Competition", "M5 CS"] },
                    { ch: "G30", eng: ["530d", "540i", "M550i"] },
                    { ch: "E38", eng: ["730d", "740i", "750iL"] },
                    { ch: "G12", eng: ["740d", "750Li", "M760Li"] },
                    { ch: "E53", eng: ["X5 3.0d", "X5 4.4i", "X5 4.8is"] },
                    { ch: "E70", eng: ["X5 3.0d", "X5 4.8i", "X5M"] },
                    { ch: "F15", eng: ["X5 40d", "X5 M50d"] },
                    { ch: "F85", eng: ["X5M"] },
                    { ch: "G05", eng: ["X5 30d", "X5 40i", "X5 M50d"] },
                    { ch: "F95", eng: ["X5M Competition"] },
                    { ch: "G07", eng: ["X7 M50d", "X7 M60i"] }
                ]
            },
            {
                brand: "Mercedes-Benz",
                configs: [
                    { ch: "W204", eng: ["C180", "C200", "C250", "C300", "C350", "C63 AMG", "C63 AMG Black Series"] },
                    { ch: "W205", eng: ["C180", "C200 4Matic", "C43 AMG", "C63 S AMG"] },
                    { ch: "W211", eng: ["E200 Kompressor", "E320 CDI", "E500", "E55 AMG", "E63 AMG"] },
                    { ch: "W212", eng: ["E200", "E250 CDI", "E300", "E350", "E400", "E63 AMG", "E63 S AMG"] },
                    { ch: "W213", eng: ["E200d", "E220d", "E300", "E400d", "E53 AMG", "E63 S AMG"] },
                    { ch: "W140", eng: ["S500", "S600"] },
                    { ch: "W222", eng: ["S350d", "S500", "S63 AMG", "S65 AMG"] },
                    { ch: "W223", eng: ["S450", "S580", "S680 Maybach"] },
                    { ch: "W463", eng: ["G500", "G55 AMG", "G63 AMG"] },
                    { ch: "W464", eng: ["G63 AMG", "G350d"] }
                ]
            },
            {
                brand: "Audi",
                configs: [
                    { ch: "C6", eng: ["A6 3.0 TDI", "S6 V10", "RS6 Avant"] },
                    { ch: "C7", eng: ["A6 3.0 TFSI", "A7 3.0 TDI", "S7", "RS6 Performance", "RS7"] },
                    { ch: "C8", eng: ["A6 55 TFSI", "RS6 Avant", "RS7 Sportback"] },
                    { ch: "8V", eng: ["S3 Sedan", "RS3 Sportback"] },
                    { ch: "B9", eng: ["A4 2.0 TFSI", "A5 Sportback", "RS4 Avant", "RS5 Coupe"] },
                    { ch: "4M", eng: ["Q7 3.0 TDI", "Q8 50 TDI", "SQ8", "RS Q8"] }
                ]
            }
        ];
        const selectedBrand = r(germans);
        const config = r(selectedBrand.configs);
        const engine = r(config.eng);
        return `${selectedBrand.brand} ${engine} ${config.ch}`;
    }

    function genLuxury() {
        const hypers = [
            "Ferrari 488 Pista", "Ferrari F8 Tributo", "Ferrari 812 Superfast", "Ferrari SF90 Stradale", "Ferrari LaFerrari", "Ferrari Enzo", "Ferrari F40",
            "Lamborghini Aventador SVJ", "Lamborghini Huracan Performante", "Lamborghini Urus", "Lamborghini Revuelto", "Lamborghini Murcielago SV", "Lamborghini Diablo VT",
            "Porsche 911 Turbo S (992)", "Porsche 911 GT3 RS (992)", "Porsche 911 GT2 RS (991)", "Porsche Carrera GT", "Porsche 918 Spyder",
            "Bugatti Chiron", "Bugatti Chiron Super Sport", "Bugatti Divo", "Bugatti Veyron Super Sport",
            "McLaren 720S", "McLaren 765LT", "McLaren P1", "McLaren Senna",
            "Rolls-Royce Phantom", "Rolls-Royce Cullinan", "Rolls-Royce Wraith",
            "Bentley Continental GT Speed", "Bentley Bentayga",
            "Koenigsegg Agera RS", "Koenigsegg Jesko",
            "Pagani Huayra BC"
        ];
        return r(hypers);
    }

    // === УПРАВЛЕНИЕ ===
    let cheatNext = null;
    let currentCar = "";
    let clicks = 0;
    let timer;

    const carNameEl = document.getElementById('carName');
    const tierLabelEl = document.getElementById('tierLabel');
    const box = document.getElementById('box');
    const spinBtn = document.getElementById('spinBtn');
    const googleBtn = document.getElementById('googleBtn');
    const cheatPanel = document.getElementById('cheatPanel');

    box.addEventListener('click', () => {
        clicks++;
        clearTimeout(timer);
        timer = setTimeout(() => clicks = 0, 400);
        if (clicks === 10) {
            clicks = 0;
            doVibrate(50);
            if (prompt("КОД ДОСТУПА:") === "758") cheatPanel.style.display = 'block';
        }
    });

    function activateCheat(tier) {
        cheatNext = tier;
        cheatPanel.style.display = 'none';
        doVibrate([50, 50]);
        alert("Следующая: " + tier.toUpperCase());
    }

    function openGoogle() {
        if (!currentCar) return;
        const query = encodeURIComponent(currentCar);
        const url = `https://www.google.com/search?tbm=isch&q=${query}`;
        window.open(url, '_blank');
    }

    function spin() {
        if (spinBtn.disabled) return;
        
        // ВАЖНО: Активация аудио контекста по жесту пользователя
        initAudio();
        
        spinBtn.disabled = true;
        googleBtn.style.display = 'none';
        
        box.className = 'output-box'; 
        carNameEl.style.opacity = 0.5;
        tierLabelEl.innerText = "ПОИСК...";

        let speed = 50;
        let steps = 0;
        const maxSteps = 20 + Math.floor(Math.random() * 10);

        function tick() {
            const funcs = [genEconomy, genMiddle, genPremium, genLuxury];
            carNameEl.innerText = funcs[Math.floor(Math.random()*funcs.length)]();
            
            playClickSound();
            doVibrate(5); 

            steps++;
            if (steps < maxSteps) {
                if(steps > maxSteps - 5) speed += 30;
                setTimeout(tick, speed);
            } else {
                finalize();
            }
        }
        tick();
    }

    function finalize() {
        let tier;
        if (cheatNext) {
            tier = cheatNext;
            cheatNext = null;
        } else {
            const rand = Math.random();
            if (rand < 0.25) tier = 'economy';
            else if (rand < 0.50) tier = 'middle';
            else if (rand < 0.75) tier = 'premium';
            else tier = 'luxury';
        }

        let resultName = "";
        let label = "";

        if (tier === 'economy') {
            resultName = genEconomy();
            label = "КЛАСС 1: ЭКОНОМ / СТОК";
            box.classList.add('glow-eco');
        } else if (tier === 'middle') {
            resultName = genMiddle();
            label = "КЛАСС 2: JDM / ТЮНИНГ";
            box.classList.add('glow-mid');
        } else if (tier === 'premium') {
            resultName = genPremium();
            label = "КЛАСС 3: НЕМЕЦКАЯ МОЩЬ";
            box.classList.add('glow-pre');
        } else {
            resultName = genLuxury();
            label = "КЛАСС 4: ЭКЗОТИКА / ГИПЕРКАРЫ";
            box.classList.add('glow-lux');
        }

        currentCar = resultName;
        carNameEl.innerText = resultName;
        carNameEl.style.opacity = 1;
        tierLabelEl.innerText = label;
        spinBtn.disabled = false;
        
        googleBtn.style.display = 'flex'; 

        doVibrate([30, 50, 30]); 
    }
</script>

</body>
</html>
