<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0b0b0b">
    <meta name="description" content="Ultimate Car Randomizer App">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>ULTIMATE CAR RANDOMIZER</title>
    <style>
        :root {
            --bg-color: #0b0b0b;
            --card: #141414;
            --text: #e0e0e0;
            --eco: #00ff9d;
            --mid: #00eaff;
            --pre: #d600ff;
            --lux: #ffbd00;
        }

        /* === ГЛОБАЛЬНАЯ БЛОКИРОВКА СКРОЛЛА === */
        html {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        body {
            background-color: var(--bg-color);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: scroll;
            
            color: var(--text);
            font-family: 'Arial Black', 'Impact', sans-serif;
            
            /* Жесткая фиксация экрана */
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            height: 100%;
            width: 100%;
            
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            
            margin: 0;
            padding: 0;
            overflow: hidden;
            overscroll-behavior: none;
            touch-action: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.5s ease;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
            pointer-events: none;
        }

        .wrapper {
            width: 90%;
            max-width: 600px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        /* === ВЕРХНИЕ КНОПКИ === */
        .settings-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        @supports (padding-top: env(safe-area-inset-top)) {
            .settings-bar { top: calc(20px + env(safe-area-inset-top)); }
        }

        .icon-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            padding: 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .icon-btn svg { width: 22px; height: 22px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .icon-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }
        .icon-btn.off { opacity: 0.5; border-color: #444; color: #888; background: rgba(0,0,0,0.8); }
        .slash { display: none; }
        .icon-btn.off .slash { display: block; }

        /* === МЕНЮ ФОНА === */
        #bgMenu {
            display: none;
            position: absolute;
            top: 80px; right: 20px; width: 260px;
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid #444;
            border-radius: 15px;
            padding: 15px;
            z-index: 1001;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            text-align: left;
        }
        @supports (padding-top: env(safe-area-inset-top)) {
            #bgMenu { top: calc(80px + env(safe-area-inset-top)); }
        }

        #bgMenu h3 { margin: 0 0 10px 0; font-size: 0.9rem; color: #888; text-transform: uppercase; font-family: 'Segoe UI', sans-serif; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .bg-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
        .bg-btn { width: 100%; aspect-ratio: 1; border-radius: 8px; border: 2px solid rgba(255,255,255,0.1); cursor: pointer; transition: transform 0.2s; position: relative; overflow: hidden; }
        .bg-btn:hover { border-color: #fff; }
        .bg-btn:active { transform: scale(0.9); }

        .c-black { background: #0b0b0b; }
        .c-gray { background: #2d2d2d; }
        .c-blue { background: #0f1c2e; }
        .c-red { background: #2e0f0f; }
        .img-merc { background: url('mercedes.jpg') center/cover; }
        .img-bmw { background: url('bmw.jpg') center/cover; }
        .img-porsche { background: url('porsche.jpg') center/cover; }

        .mobile-wallpapers { display: none; }
        @media (max-width: 768px) { .mobile-wallpapers { display: block; } }

        /* === ИНТЕРФЕЙС === */
        h1 {
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            margin-bottom: 30px;
            line-height: 1.2;
            width: 100%;
        }

        .output-box {
            background: rgba(20, 20, 20, 0.85);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            transition: 0.1s transform, 0.3s border-color, 0.3s box-shadow;
            cursor: pointer;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        .output-box:active { transform: scale(0.98); }

        #carName {
            font-size: 1.8rem;
            line-height: 1.2;
            text-transform: uppercase;
            background: -webkit-linear-gradient(#fff, #aaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
            margin-bottom: 10px;
            word-break: break-word;
        }

        #tierLabel {
            font-family: 'Segoe UI', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 3px;
            color: #999;
            font-weight: 700;
            text-transform: uppercase;
        }

        .controls { 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            margin-top: 20px; 
        }

        .btn {
            background: #fff;
            color: #000;
            border: none;
            padding: 20px 0;
            width: 100%;
            font-size: 1.4rem;
            font-weight: 900;
            text-transform: uppercase;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.1s;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
        }
        .btn:active { transform: translateY(2px); background: #ddd; }
        .btn:disabled { background: #333; color: #555; transform: none; box-shadow: none;}

        #googleBtn {
            display: none;
            background: rgba(0,0,0,0.6);
            color: #aaa;
            border: 2px solid rgba(255,255,255,0.2);
            padding: 15px 0;
            width: 100%;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'Segoe UI', sans-serif;
            letter-spacing: 1px;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        #googleBtn svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; }
        #googleBtn:hover { border-color: #fff; color: #fff; background: rgba(0,0,0,0.8); }
        #googleBtn:active { transform: scale(0.98); }

        /* Подсветка */
        .glow-eco { border-color: var(--eco); box-shadow: 0 0 40px rgba(0,255,157,0.15); }
        .glow-eco #carName { background: -webkit-linear-gradient(#fff, var(--eco)); -webkit-background-clip: text; }
        .glow-mid { border-color: var(--mid); box-shadow: 0 0 50px rgba(0,234,255,0.2); }
        .glow-mid #carName { background: -webkit-linear-gradient(#fff, var(--mid)); -webkit-background-clip: text; }
        .glow-pre { border-color: var(--pre); box-shadow: 0 0 60px rgba(214,0,255,0.25); }
        .glow-pre #carName { background: -webkit-linear-gradient(#fff, var(--pre)); -webkit-background-clip: text; }
        .glow-lux { border-color: var(--lux); box-shadow: 0 0 80px rgba(255,189,0,0.3); }
        .glow-lux #carName { background: -webkit-linear-gradient(#fff, var(--lux)); -webkit-background-clip: text; }

        /* Админка */
        #cheatPanel {
            display: none; position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: #000; border: 2px solid red; padding: 10px; z-index: 2000;
            box-shadow: 0 0 30px rgba(255,0,0,0.5); width: 80%; max-width: 400px; text-align: center; border-radius: 10px;
        }
        .cheat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 5px; }
        .cheat-btn { padding: 10px; cursor: pointer; font-weight: bold; border:none; font-size: 0.8rem; border-radius: 5px; }
    </style>
</head>
<body>

<div class="settings-bar">
    <button class="icon-btn" id="bgToggle" onclick="toggleBgMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>
    </button>
    <button class="icon-btn" id="vibroToggle" onclick="toggleVibro()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <rect x="10" y="4" width="4" height="16" rx="2"></rect>
            <path d="M7 8 L6 8"></path><path d="M7 12 L6 12"></path><path d="M7 16 L6 16"></path>
            <path d="M17 8 L18 8"></path><path d="M17 12 L18 12"></path><path d="M17 16 L18 16"></path>
            <line x1="3" y1="3" x2="21" y2="21" class="slash" stroke="#888"></line>
        </svg>
    </button>
    <button class="icon-btn" id="soundToggle" onclick="toggleSound()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            <line x1="23" y1="9" x2="17" y2="15" class="slash" stroke="#888"></line>
            <line x1="17" y1="9" x2="23" y2="15" class="slash" stroke="#888"></line>
        </svg>
    </button>
</div>

<div id="bgMenu">
    <h3>Цвета</h3>
    <div class="bg-grid">
        <div class="bg-btn c-black" onclick="setBgColor('#0b0b0b')"></div>
        <div class="bg-btn c-gray" onclick="setBgColor('#2d2d2d')"></div>
        <div class="bg-btn c-blue" onclick="setBgColor('#0f1c2e')"></div>
        <div class="bg-btn c-red" onclick="setBgColor('#2e0f0f')"></div>
    </div>
    <div class="mobile-wallpapers">
        <h3>Обои</h3>
        <div class="bg-grid">
            <div class="bg-btn img-merc" onclick="setBgImage('mercedes.jpg')"></div>
            <div class="bg-btn img-bmw" onclick="setBgImage('bmw.jpg')"></div>
            <div class="bg-btn img-porsche" onclick="setBgImage('porsche.jpg')"></div>
        </div>
    </div>
</div>

<div id="cheatPanel">
    <div style="color:red; font-size:10px; font-weight:bold">АДМИН ПАНЕЛЬ</div>
    <div class="cheat-grid">
        <button class="cheat-btn" style="background:var(--eco)" onclick="activateCheat('economy')">ЭКО</button>
        <button class="cheat-btn" style="background:var(--mid)" onclick="activateCheat('middle')">СРЕД</button>
        <button class="cheat-btn" style="background:var(--pre); color:white" onclick="activateCheat('premium')">ПРЕМ</button>
        <button class="cheat-btn" style="background:var(--lux)" onclick="activateCheat('luxury')">ЛЮКС</button>
    </div>
</div>

<div class="wrapper">
    <h1>Car Randomizer</h1>

    <div class="output-box" id="box">
        <div id="carName">ГОТОВО</div>
        <div id="tierLabel">НАЖМИ КНОПКУ</div>
    </div>

    <div class="controls">
        <button class="btn" id="spinBtn" onclick="spin()">КРУТИТЬ</button>
        <button id="googleBtn" onclick="openGoogle()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
            ПОСМОТРЕТЬ ФОТО
        </button>
    </div>
</div>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js').catch(err => console.log('SW Fail:', err));
        });
    }

    // === UI LOGIC ===
    function toggleBgMenu() {
        const menu = document.getElementById('bgMenu');
        menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
    }
    document.addEventListener('click', (e) => {
        const menu = document.getElementById('bgMenu');
        const btn = document.getElementById('bgToggle');
        if (!menu.contains(e.target) && !btn.contains(e.target)) menu.style.display = 'none';
    });
    function setBgColor(c) {
        document.body.style.backgroundImage = 'none';
        document.body.style.backgroundColor = c;
        document.getElementById('bgMenu').style.display = 'none';
        localStorage.setItem('carApp_bgType', 'color');
        localStorage.setItem('carApp_bgValue', c);
    }
    function setBgImage(f) {
        document.body.style.backgroundColor = '#0b0b0b';
        document.body.style.backgroundImage = `url('${f}')`;
        document.getElementById('bgMenu').style.display = 'none';
        localStorage.setItem('carApp_bgType', 'image');
        localStorage.setItem('carApp_bgValue', f);
    }

    // === AUDIO & VIBRO ===
    let audioCtx = null;
    let isSoundOn = true;
    let isVibroOn = true;

    function initAudio() {
        if (!audioCtx) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    function playClickSound() {
        if (!isSoundOn || !audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        osc.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        osc.type = 'triangle'; 
        osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
        osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.05);
        gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.05);
    }

    function toggleSound() {
        isSoundOn = !isSoundOn;
        const btn = document.getElementById('soundToggle');
        if(!isSoundOn) btn.classList.add('off'); else btn.classList.remove('off');
        localStorage.setItem('carApp_sound', isSoundOn);
        initAudio();
    }

    function toggleVibro() {
        isVibroOn = !isVibroOn;
        const btn = document.getElementById('vibroToggle');
        if(!isVibroOn) btn.classList.add('off'); else btn.classList.remove('off');
        localStorage.setItem('carApp_vibro', isVibroOn);
    }

    function doVibrate(pattern) {
        if (isVibroOn && navigator.vibrate) {
            try { navigator.vibrate(pattern); } catch(e){}
        }
    }

    // === INIT ===
    function initSettings() {
        const savedSound = localStorage.getItem('carApp_sound');
        if (savedSound === 'false') {
            isSoundOn = false;
            document.getElementById('soundToggle').classList.add('off');
        }
        const savedVibro = localStorage.getItem('carApp_vibro');
        if (savedVibro === 'false') {
            isVibroOn = false;
            document.getElementById('vibroToggle').classList.add('off');
        }
        const bgType = localStorage.getItem('carApp_bgType');
        const bgValue = localStorage.getItem('carApp_bgValue');
        if (bgType === 'color' && bgValue) {
            document.body.style.backgroundImage = 'none';
            document.body.style.backgroundColor = bgValue;
        } else if (bgType === 'image' && bgValue) {
            document.body.style.backgroundColor = '#0b0b0b';
            document.body.style.backgroundImage = `url('${bgValue}')`;
        }
    }

    // === GENERATOR (РАЗВЕРНУТЫЕ СПИСКИ) ===
    const r = (arr) => arr[Math.floor(Math.random() * arr.length)];
    
    function genEconomy() {
        // БЮДЖЕТ (Включая Китай)
        const pool = [
            () => `Lada Priora ${r(['Sedan', 'Hatchback', 'Coupe'])}`,
            () => `Lada Vesta ${r(['NG', 'SW Cross', 'Sport', '1.8'])}`,
            () => `Lada Granta ${r(['Drive Active', 'Sport', 'FL'])}`,
            () => `Lada 2114 ${r(['Super-Avto', '1.6'])}`,
            () => `Volkswagen Polo ${r(['Sedan', 'GT', 'Liftback'])}`,
            () => `Skoda Rapid ${r(['1.4 TSI', '1.6 MPI', 'Monte Carlo'])}`,
            () => `Skoda Octavia ${r(['A5', 'A7', 'A8'])} 1.6 MPI`,
            () => `Hyundai Solaris ${r(['1.6 MT', '1.6 AT', 'Restyling'])}`,
            () => `Kia Rio ${r(['3', '4', 'X-Line'])}`,
            () => `Toyota Corolla ${r(['120', '150'])}`,
            () => `Honda Civic ${r(['EK3', 'EK9', 'ES', '4D', '5D'])}`,
            () => `Mazda 3 ${r(['BK', 'BL', 'BM'])}`,
            () => `Mitsubishi Lancer ${r(['9', 'X 1.8', 'X 2.0'])}`,
            // Китай Эконом
            () => `Haval M6`,
            () => `Chery Tiggo 4 Pro`,
            () => `Geely Emgrand`,
            () => `Omoda S5`,
            () => `Kaiyi E5`,
            () => `BAIC U5 Plus`,
            () => `JAC J7`,
            () => `Changan Alsvin`,
            () => `Haval Jolion ${r(['Comfort', 'Elite'])}`
        ];
        return r(pool)();
    }
    
    function genMiddle() {
        // СРЕДНИЙ КЛАСС (Включая Китай)
        const brands = {
            toyota: [
                { model: "Mark II", chassis: ["JZX90", "JZX100", "JZX110"], trims: ["Grande", "Tourer S", "Tourer V", "iR-V"] },
                { model: "Chaser", chassis: ["JZX100", "JZX90"], trims: ["Tourer V", "Avante G"] },
                { model: "Cresta", chassis: ["JZX90", "JZX100"], trims: ["Roulant G", "Super Lucent"] },
                { model: "Crown", chassis: ["S170", "S180", "S200", "S210"], trims: ["Athlete", "Majesta", "Royal Saloon"] },
                { model: "Camry", chassis: ["XV40", "XV50", "XV55", "XV70"], trims: ["3.5 V6", "2.5", "Hybrid"] },
                { model: "Altezza", chassis: ["SXE10"], trims: ["RS200", "AS200"] }
            ],
            nissan: [
                { model: "Silvia", chassis: ["S13", "S14", "S15"], trims: ["Spec-R", "Spec-S", "Q's", "K's"] },
                { model: "Skyline", chassis: ["R32", "R33", "R34"], trims: ["GTS-T", "GT-T", "Sedan"] },
                { model: "Laurel", chassis: ["C33", "C34", "C35"], trims: ["Club-S", "Medalist"] },
                { model: "Teana", chassis: ["J31", "J32"], trims: ["3.5 V6", "2.5"] }
            ],
            subaru: [
                { model: "Impreza WRX STI", chassis: ["GC8", "GDB Peanut", "GDB Blobeye", "GDB Hawkeye", "GRB", "VA"], trims: [""] },
                { model: "Forester", chassis: ["SF5", "SG5", "SG9", "SH"], trims: ["STI", "Cross Sports", "XT"] }
            ],
            honda: [
                { model: "Accord", chassis: ["CL7", "CL9", "CU2", "CV"], trims: ["Euro-R", "Type-S", "2.4"] },
                { model: "Civic", chassis: ["Type-R EP3", "Type-R FN2", "Type-R FD2"], trims: [""] }
            ],
            // Китай Средний
            haval: [
                { model: "F7x", chassis: [""], trims: ["Tech Plus", "Premium"] },
                { model: "Dargo", chassis: ["X"], trims: ["Tech Plus"] },
                { model: "H9", chassis: ["Restyling"], trims: ["Premium"] } 
            ],
            geely: [
                { model: "Coolray", chassis: [""], trims: ["Flagship Sport"] },
                { model: "Atlas Pro", chassis: ["4WD"], trims: ["Flagship"] },
                { model: "Tugella", chassis: [""], trims: ["Flagship Sport"] }
            ],
            chery: [
                { model: "Tiggo 7 Pro Max", chassis: ["AWD"], trims: ["Ultimate"] },
                { model: "Tiggo 8 Pro Max", chassis: ["New"], trims: ["Ultimate"] },
                { model: "Arrizo 8", chassis: ["Highline"], trims: ["Ultimate"] }
            ],
            tank: [ { model: "300", chassis: ["City"], trims: ["Premium"] } ],
            jetour: [ { model: "Dashing", chassis: ["1.6T"], trims: ["Luxury"] }, { model: "T2", chassis: ["4WD"], trims: ["Expedition"] } ]
        };
        const k=r(Object.keys(brands)), c=r(brands[k]); 
        // Формируем строку
        let res = `${k.charAt(0).toUpperCase()+k.slice(1)} ${c.model}`;
        if (c.chassis && c.chassis[0] !== "") res += ` ${r(c.chassis)}`;
        if (c.trims && c.trims[0] !== "") res += ` ${r(c.trims)}`;
        return res;
    }
    
    function genPremium() {
        // ПРЕМИУМ (Включая Китай)
        const g=[
            // BMW
            {b:"BMW",c:[{h:"E36",e:["318is","320i","325i","328i","M3"]},{h:"E46",e:["320i","325i","330Ci","330d","M3","M3 CSL"]},{h:"E92",e:["320i","325i","330d","335i","M3"]},{h:"F30",e:["320d","328i","330i","335i","340i"]},{h:"F80",e:["M3","M3 Competition","M3 CS"]},{h:"G20",e:["320d","330i","M340i"]},{h:"G80",e:["M3","M3 Competition"]},{h:"E34",e:["525i","530i","540i","M5 3.8"]},{h:"E39",e:["525i","530d","540i","M5"]},{h:"E60",e:["525i","530d","535d","545i","550i","M5"]},{h:"F10",e:["520d","528i","530d","535i","550i","M550d","M5"]},{h:"F90",e:["M5","M5 Competition","M5 CS"]},{h:"G30",e:["530d","540i","M550i"]},{h:"E38",e:["730d","740i","750iL"]},{h:"G12",e:["740d","750Li","M760Li"]},{h:"E53",e:["X5 3.0d","X5 4.4i","X5 4.8is"]},{h:"E70",e:["X5 3.0d","X5 4.8i","X5M"]},{h:"F15",e:["X5 40d","X5 M50d"]},{h:"F85",e:["X5M"]},{h:"G05",e:["X5 30d","X5 40i","X5 M50d"]},{h:"F95",e:["X5M Competition"]},{h:"G07",e:["X7 M50d","X7 M60i"]}]},
            // Mercedes
            {b:"Mercedes-Benz",c:[{h:"W204",e:["C180","C200","C250","C300","C350","C63 AMG","C63 AMG Black Series"]},{h:"W205",e:["C180","C200 4Matic","C43 AMG","C63 S AMG"]},{h:"W211",e:["E200 Kompressor","E320 CDI","E500","E55 AMG","E63 AMG"]},{h:"W212",e:["E200","E250 CDI","E300","E350","E400","E63 AMG","E63 S AMG"]},{h:"W213",e:["E200d","E220d","E300","E400d","E53 AMG","E63 S AMG"]},{h:"W140",e:["S500","S600"]},{h:"W222",e:["S350d","S500","S63 AMG","S65 AMG"]},{h:"W223",e:["S450","S580","S680 Maybach"]},{h:"W463",e:["G500","G55 AMG","G63 AMG"]},{h:"W464",e:["G63 AMG","G350d"]}]},
            // Audi
            {b:"Audi",c:[{h:"C6",e:["A6 3.0 TDI","S6 V10","RS6 Avant"]},{h:"C7",e:["A6 3.0 TFSI","A7 3.0 TDI","S7","RS6 Performance","RS7"]},{h:"C8",e:["A6 55 TFSI","RS6 Avant","RS7 Sportback"]},{h:"8V",e:["S3 Sedan","RS3 Sportback"]},{h:"B9",e:["A4 2.0 TFSI","A5 Sportback","RS4 Avant","RS5 Coupe"]},{h:"4M",e:["Q7 3.0 TDI","Q8 50 TDI","SQ8","RS Q8"]}]},
            // Китай Премиум
            {b:"Zeekr",c:[{h:"",e:["001 YOU","001 ME","007 Performance","X","009"]}]},
            {b:"Li Auto",c:[{h:"",e:["L7 Max","L7 Ultra","L9 Max","L9 Ultra","L6","One"]}]},
            {b:"Geely",c:[{h:"",e:["Monjaro Exclusive","Prefecture L"]}]},
            {b:"Exeed",c:[{h:"",e:["VX President","RX"]}]},
            {b:"Voyah",c:[{h:"",e:["Free EVR","Dream","Passion"]}]},
            {b:"Tank",c:[{h:"",e:["500 Urban","500 Premium"]}]},
            {b:"Avatr",c:[{h:"",e:["11","12"]}]},
            {b:"HiPhi",c:[{h:"",e:["Z","X"]}]}
        ];
        const s=r(g), f=r(s.c); 
        let res = `${s.b} ${r(f.e)}`;
        if(f.h) res += ` ${f.h}`;
        return res;
    }
    
    function genLuxury() {
        // ЛЮКС (Включая Китай)
        return r([
            "Ferrari 488 Pista",
            "Ferrari F8 Tributo",
            "Ferrari 812 Superfast",
            "Ferrari SF90 Stradale",
            "Ferrari LaFerrari",
            "Ferrari Enzo",
            "Ferrari F40",
            "Lamborghini Aventador SVJ",
            "Lamborghini Huracan Performante",
            "Lamborghini Urus",
            "Lamborghini Revuelto",
            "Lamborghini Murcielago SV",
            "Lamborghini Diablo VT",
            "Porsche 911 Turbo S (992)",
            "Porsche 911 GT3 RS (992)",
            "Porsche 911 GT2 RS (991)",
            "Porsche Carrera GT",
            "Porsche 918 Spyder",
            "Bugatti Chiron",
            "Bugatti Chiron Super Sport",
            "Bugatti Divo",
            "Bugatti Veyron Super Sport",
            "McLaren 720S",
            "McLaren 765LT",
            "McLaren P1",
            "McLaren Senna",
            "Rolls-Royce Phantom",
            "Rolls-Royce Cullinan",
            "Rolls-Royce Wraith",
            "Bentley Continental GT Speed",
            "Bentley Bentayga",
            "Koenigsegg Agera RS",
            "Koenigsegg Jesko",
            "Pagani Huayra BC",
            // Китай Люкс
            "YangWang U8 Premium",
            "YangWang U9",
            "Lotus Eletre R",
            "Lotus Emeya",
            "Hongqi E-HS9 Executive",
            "Hongqi H9+", 
            "Zeekr 001 FR",
            "HiPhi A",
            "Tank 700 Hi4-T"
        ]);
    }

    // === MAIN LOGIC ===
    let cheatNext = null;
    let currentCar = "";
    let clicks = 0;
    let timer;

    const carNameEl = document.getElementById('carName');
    const tierLabelEl = document.getElementById('tierLabel');
    const box = document.getElementById('box');
    const spinBtn = document.getElementById('spinBtn');
    const googleBtn = document.getElementById('googleBtn');
    const cheatPanel = document.getElementById('cheatPanel');

    document.addEventListener('DOMContentLoaded', initSettings);

    box.addEventListener('click', () => {
        clicks++;
        clearTimeout(timer);
        timer = setTimeout(() => clicks = 0, 400);
        if (clicks === 10) {
            clicks = 0;
            doVibrate(50);
            if (prompt("КОД ДОСТУПА:") === "758") cheatPanel.style.display = 'grid';
        }
    });

    function activateCheat(tier) {
        cheatNext = tier;
        cheatPanel.style.display = 'none';
        doVibrate([50, 50]);
        alert("Следующая: " + tier.toUpperCase());
    }

    function openGoogle() {
        if (!currentCar) return;
        const query = encodeURIComponent(currentCar);
        window.open(`https://www.google.com/search?tbm=isch&q=${query}`, '_blank');
    }

    function spin() {
        if (spinBtn.disabled) return;
        
        initAudio();
        spinBtn.disabled = true;
        googleBtn.style.display = 'none';
        
        box.className = 'output-box'; 
        carNameEl.style.opacity = 0.5;
        tierLabelEl.innerText = "ПОИСК...";

        let speed = 50;
        let steps = 0;
        const maxSteps = 20 + Math.floor(Math.random() * 10);

        function tick() {
            const funcs = [genEconomy, genMiddle, genPremium, genLuxury];
            carNameEl.innerText = funcs[Math.floor(Math.random()*funcs.length)]();
            
            playClickSound();
            doVibrate(5); 

            steps++;
            if (steps < maxSteps) {
                if(steps > maxSteps - 5) speed += 30;
                setTimeout(tick, speed);
            } else {
                finalize();
            }
        }
        tick();
    }

    function finalize() {
        let tier;
        if (cheatNext) {
            tier = cheatNext;
            cheatNext = null;
        } else {
            const rand = Math.random();
            if (rand < 0.25) tier = 'economy';
            else if (rand < 0.50) tier = 'middle';
            else if (rand < 0.75) tier = 'premium';
            else tier = 'luxury';
        }

        let resultName = "";
        let label = "";
        let glowClass = "";

        if (tier === 'economy') {
            resultName = genEconomy();
            label = "КЛАСС 1: ЭКОНОМ / СТОК";
            glowClass = 'glow-eco';
        } else if (tier === 'middle') {
            resultName = genMiddle();
            label = "КЛАСС 2: JDM / ТЮНИНГ";
            glowClass = 'glow-mid';
        } else if (tier === 'premium') {
            resultName = genPremium();
            label = "КЛАСС 3: НЕМЕЦКАЯ МОЩЬ";
            glowClass = 'glow-pre';
        } else {
            resultName = genLuxury();
            label = "КЛАСС 4: ЭКЗОТИКА / ГИПЕРКАРЫ";
            glowClass = 'glow-lux';
        }

        currentCar = resultName;
        carNameEl.innerText = resultName;
        carNameEl.style.opacity = 1;
        tierLabelEl.innerText = label;
        box.classList.add(glowClass);
        spinBtn.disabled = false;
        
        googleBtn.style.display = 'flex'; 

        doVibrate([30, 50, 30]); 
    }
</script>

</body>
</html>
