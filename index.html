<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#121212">
    <meta name="description" content="Ultimate Car Randomizer">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>CAR RANDOMIZER</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');

        :root {
            --eco: #00ff9d; --mid: #00eaff; --pre: #d600ff; --lux: #ffbd00; --mat: #ff0040;
            --bg-dark: #121212; --panel: rgba(30, 30, 30, 0.95);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            margin: 0; padding: 0; height: 100vh; width: 100vw; overflow: hidden;
            /* CARBON TEXTURE */
            background-color: var(--bg-dark);
            background-image: 
                linear-gradient(27deg, #151515 5px, transparent 5px),
                linear-gradient(207deg, #151515 5px, transparent 5px),
                linear-gradient(27deg, #222 5px, transparent 5px),
                linear-gradient(207deg, #222 5px, transparent 5px);
            background-size: 28px 28px;
            background-position: 0 5px, 14px 0, 0 10px, 14px 5px;
            
            font-family: 'Montserrat', sans-serif; color: #fff;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            user-select: none; transition: background 0.3s;
        }

        /* STRIPES */
        .stripes { position: fixed; left: 20px; top: 0; bottom: 0; width: 24px; display: flex; z-index: 0; opacity: 0.8; }
        .stripe { width: 33.3%; height: 100%; }
        .s1 { background: #5ea2d6; } .s2 { background: #1f3966; } .s3 { background: #b51f1f; }

        /* UI */
        .top-bar { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 100; }
        @supports (padding-top: env(safe-area-inset-top)) { .top-bar { top: calc(20px + env(safe-area-inset-top)); } }

        .circle-btn { width: 46px; height: 46px; border-radius: 50%; background: rgba(50, 50, 50, 0.8); border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(5px); transition: 0.1s; }
        .circle-btn:active { transform: scale(0.95); }
        .circle-btn svg { width: 20px; height: 20px; fill: none; stroke: #fff; stroke-width: 2; }
        .circle-btn.off svg { stroke: #666; }

        /* MAIN WRAPPER */
        .wrapper { position: relative; z-index: 10; width: 85%; max-width: 420px; display: flex; flex-direction: column; gap: 20px; text-align: center; }
        .logo { font-size: 14px; letter-spacing: 4px; font-weight: 900; opacity: 0.7; margin-bottom: 10px; }

        /* STEP-BY-STEP OUTPUT BOX */
        .output-box {
            background: var(--panel); border: 2px solid rgba(255, 255, 255, 0.15); border-radius: 20px;
            min-height: 280px; padding: 25px;
            display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 10px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.7); transition: 0.3s;
        }

        .step-row { opacity: 0; transform: translateY(10px); transition: 0.4s ease-out; width: 100%; }
        .step-row.visible { opacity: 1; transform: translateY(0); }
        .step-row.hidden { display: none; }

        /* TYPOGRAPHY */
        #stepTier { font-size: 12px; font-weight: 800; letter-spacing: 3px; text-transform: uppercase; color: #777; margin-bottom: 5px; }
        #stepBrand { font-size: 28px; font-weight: 900; text-transform: uppercase; line-height: 1; color: #fff; }
        #stepModel { font-size: 24px; font-weight: 700; text-transform: uppercase; color: #ddd; }
        #stepSpec { font-size: 16px; font-weight: 500; color: #aaa; margin-top: 5px; }
        #stepTune { font-size: 14px; font-weight: 800; color: var(--mat); margin-top: 10px; letter-spacing: 1px; text-shadow: 0 0 10px rgba(255,0,64,0.3); }
        
        #initialMsg { opacity: 0.5; font-weight: 700; letter-spacing: 2px; font-size: 14px; }

        /* CONTROLS */
        .controls { display: grid; grid-template-columns: 1fr; gap: 15px; width: 100%; }
        .btn-main { background: #fff; color: #000; border: none; height: 65px; border-radius: 14px; font-size: 20px; font-weight: 900; letter-spacing: 1px; text-transform: uppercase; cursor: pointer; box-shadow: 0 5px 20px rgba(255,255,255,0.1); transition: 0.1s; }
        .btn-main:active { transform: translateY(2px); background: #e0e0e0; }
        .btn-main:disabled { background: #333; color: #555; box-shadow: none; cursor: default; }

        .btn-sec {
            background: rgba(255,255,255,0.05); color: #ccc; border: 1px solid rgba(255,255,255,0.15); height: 50px; border-radius: 14px; font-size: 14px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .btn-sec.visible { opacity: 1; pointer-events: auto; }
        .btn-sec:active { background: rgba(255,255,255,0.15); color: #fff; }

        /* MENUS */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 1000; opacity: 0; pointer-events: none; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .menu-box { background: #1a1a1a; border: 1px solid #333; border-radius: 20px; padding: 20px; width: 80%; max-width: 300px; text-align: center; }
        .bg-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .bg-btn { height: 60px; border-radius: 10px; border: 2px solid #333; cursor: pointer; background-size: cover; background-position: center; }

        /* CHEAT */
        #cheatMenu { position: absolute; top: 80px; left: 50%; transform: translateX(-50%); background: rgba(20,20,20,0.95); border: 1px solid #444; border-radius: 10px; padding: 5px; z-index: 2000; display: none; flex-direction: column; gap: 5px; box-shadow: 0 10px 40px #000; width: 120px; }
        .cheat-btn { background: #222; color: #fff; border: none; padding: 10px; font-size: 12px; font-weight: bold; cursor: pointer; border-radius: 4px; text-transform: uppercase; }

        /* COLORS */
        .c-eco { color: var(--eco) !important; text-shadow: 0 0 15px var(--eco); }
        .c-mid { color: var(--mid) !important; text-shadow: 0 0 15px var(--mid); }
        .c-pre { color: var(--pre) !important; text-shadow: 0 0 15px var(--pre); }
        .c-lux { color: var(--lux) !important; text-shadow: 0 0 15px var(--lux); }
        .c-mat { color: var(--mat) !important; text-shadow: 0 0 15px var(--mat); }
        .b-eco { border-color: var(--eco); box-shadow: 0 0 30px rgba(52, 211, 153, 0.2); }
        .b-mid { border-color: var(--mid); box-shadow: 0 0 40px rgba(96, 165, 250, 0.2); }
        .b-pre { border-color: var(--pre); box-shadow: 0 0 50px rgba(167, 139, 250, 0.2); }
        .b-lux { border-color: var(--lux); box-shadow: 0 0 60px rgba(251, 191, 36, 0.25); }
        .b-mat { border-color: var(--mat); box-shadow: 0 0 80px rgba(244, 63, 94, 0.4); }
    </style>
</head>
<body>

<div class="stripes"><div class="stripe s1"></div><div class="stripe s2"></div><div class="stripe s3"></div></div>

<div class="top-bar">
    <div class="circle-btn" onclick="openBgMenu()"><svg viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg></div>
    <div class="circle-btn" id="vibBtn" onclick="toggleVibro()"><svg viewBox="0 0 24 24"><rect x="10" y="4" width="4" height="16" rx="2"/><line class="slash" x1="3" y1="3" x2="21" y2="21"/></svg></div>
    <div class="circle-btn" id="sndBtn" onclick="toggleSound()"><svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line class="slash" x1="23" y1="9" x2="17" y2="15"/></svg></div>
</div>

<div id="cheatMenu">
    <button class="cheat-btn" onclick="setCheat('economy')" style="color:var(--eco)">Eco</button>
    <button class="cheat-btn" onclick="setCheat('middle')" style="color:var(--mid)">Mid</button>
    <button class="cheat-btn" onclick="setCheat('premium')" style="color:var(--pre)">Pre</button>
    <button class="cheat-btn" onclick="setCheat('luxury')" style="color:var(--lux)">Lux</button>
    <button class="cheat-btn" onclick="setCheat('matmall')" style="color:var(--mat)">Mat</button>
</div>

<div class="wrapper">
    <div class="logo">CAR RANDOMIZER</div>
    
    <div class="output-box" id="box">
        <div id="initialMsg">ГОТОВО К ЗАЕЗДУ</div>
        
        <div id="stepTier" class="step-row hidden"></div>
        <div id="stepBrand" class="step-row hidden"></div>
        <div id="stepModel" class="step-row hidden"></div>
        <div id="stepSpec" class="step-row hidden"></div>
        <div id="stepTune" class="step-row hidden"></div>
    </div>

    <div class="controls">
        <button class="btn-main" id="spinBtn" onclick="spin()">КРУТИТЬ</button>
        <button class="btn-sec" id="googleBtn" onclick="openGoogle()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            ПОСМОТРЕТЬ ФОТО
        </button>
    </div>
</div>

<div class="modal-overlay" id="bgModal" onclick="if(event.target===this)closeBgMenu()">
    <div class="menu-box">
        <div style="font-weight:900;margin-bottom:15px;color:#fff">ФОН</div>
        <div class="bg-grid">
            <div class="bg-btn" style="background:#121212" onclick="setBg('c','#121212')"></div>
            <div class="bg-btn" style="background:#000" onclick="setBg('c','#000')"></div>
            <div class="bg-btn" style="background:#1a1f2e" onclick="setBg('c','#1a1f2e')"></div>
            <div class="bg-btn" style="background:url('mercedes.jpg') center/cover" onclick="setBg('i','mercedes.jpg')"></div>
            <div class="bg-btn" style="background:url('bmw.jpg') center/cover" onclick="setBg('i','bmw.jpg')"></div>
            <div class="bg-btn" style="background:url('porsche.jpg') center/cover" onclick="setBg('i','porsche.jpg')"></div>
        </div>
    </div>
</div>

<script>
    // --- STATE ---
    let sound=true, vibro=true, cheat=null, currentCar="", carData=null;
    let audioCtx=null;

    window.onload = () => {
        if(localStorage.getItem('snd')==='0') toggleSound();
        if(localStorage.getItem('vib')==='0') toggleVibro();
        const bt=localStorage.getItem('bt'), bv=localStorage.getItem('bv');
        if(bt&&bv) applyBg(bt,bv);

        document.querySelector('.logo').addEventListener('click', (e) => {
            if(e.detail===3 && prompt("CODE")==="758") document.getElementById('cheatMenu').style.display='flex';
        });
    };

    // --- UTILS ---
    const el = (id) => document.getElementById(id);
    const r = (a) => a[Math.floor(Math.random() * a.length)];
    const ch = (p) => Math.random() < p;
    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

    // --- AUDIO ---
    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); if(audioCtx.state==='suspended') audioCtx.resume(); }
    function beep(f=800, t=0.05) { if(sound&&audioCtx){ const o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.connect(g);g.connect(audioCtx.destination); o.type='triangle'; o.frequency.value=f; g.gain.setValueAtTime(0.1,audioCtx.currentTime); g.gain.linearRampToValueAtTime(0,audioCtx.currentTime+t); o.start();o.stop(audioCtx.currentTime+t); } }
    function vib(p) { if(vibro&&navigator.vibrate) navigator.vibrate(p); }

    function toggleSound() { sound=!sound; el('sndBtn').classList.toggle('off', !sound); localStorage.setItem('snd', sound?'1':'0'); if(sound)initAudio(); }
    function toggleVibro() { vibro=!vibro; el('vibBtn').classList.toggle('off', !vibro); localStorage.setItem('vib', vibro?'1':'0'); }
    function setCheat(val) { cheat=val; document.getElementById('cheatMenu').style.display='none'; vib(50); }
    
    function openBgMenu(){ el('bgModal').classList.add('active'); }
    function closeBgMenu(){ el('bgModal').classList.remove('active'); }
    function setBg(t,v){ applyBg(t,v); localStorage.setItem('bt',t); localStorage.setItem('bv',v); closeBgMenu(); }
    function applyBg(t,v){ if(t==='c') { document.body.style.background=v; document.body.style.backgroundImage='none'; } else { document.body.style.background=`url('${v}') center/cover fixed`; } }

    // --- MASSIVE DATA GENERATORS ---
    function getTune(type) {
        if (!ch(0.2)) return null; 
        const t = {
            'bmw': ['Manhart','G-Power','Alpina','Hamann','AC Schnitzer','Stage 2','Stage 3'],
            'merc': ['Brabus','Mansory','Renntech','Rocket 900','Wald'],
            'jdm': ['HKS','VeilSide','Liberty Walk','Rocket Bunny','BN Sports','Drift Spec'],
            'lada': ['Stinger Exhaust','Stage 2','Turbo Kit','Na Pnevme','Bunker'],
            'china': ['Black Edition','Sport Package','Chip Tuning','Offroad Kit'],
            'super': ['Mansory','Novitec','Underground Racing','DMC']
        };
        return r(t[type] || ['Stage 1']);
    }

    function generate() {
        let t = cheat || (()=>{const x=Math.random();return x<0.01?'matmall':x<0.26?'economy':x<0.51?'middle':x<0.76?'premium':'luxury'})();
        cheat=null;
        
        let res = { tier:'', tierName:'', brand:'', model:'', spec:'', tune:null, css:'' };

        if(t=='economy'){
            res.tier='economy'; res.tierName='ЭКОНОМ'; res.css='b-eco'; res.tcss='c-eco';
            const cars = [
                () => `Lada Vesta_NG ${r(['Sport','Cross','Luxe','SW'])}`, () => `Lada Priora ${r(['Sedan','Hatchback','Coupe'])}`,
                () => `Volkswagen Polo ${r(['1.6','1.4 TSI','GT'])}`, () => `Skoda Rapid ${r(['1.6 MPI','1.4 TSI','Monte Carlo'])}`,
                () => `Hyundai Solaris ${r(['1.4','1.6','AT'])}`, () => `Kia Rio ${r(['3','4','X-Line','GT-Line'])}`,
                () => `Toyota Corolla ${r(['120','150','1.6'])}`, () => `Honda Civic ${r(['EK9','4D','5D'])}` + (ch(0.5)?'|jdm':''),
                () => `Mazda 3 ${r(['BK','BL','BM'])}`, () => `Mitsubishi Lancer ${r(['9','X','1.6','2.0'])}`,
                () => `Haval Jolion ${r(['Comfort','Premium'])}`, () => `Geely Emgrand ${r(['Comfort','Luxury'])}`,
                () => `Chery Tiggo_4 Pro`, () => `Omoda S5 GT`
            ];
            parseRes(r(cars)(), res, 'lada'); 
        } else if(t=='middle'){
            res.tier='middle'; res.tierName='СРЕДНИЙ / JDM'; res.css='b-mid'; res.tcss='c-mid';
            const cars = [
                () => `Toyota Mark_II ${r(['JZX90','JZX100','Tourer V'])}|jdm`, () => `Toyota Chaser ${r(['JZX100','Tourer V'])}|jdm`,
                () => `Toyota Camry ${r(['XV40','XV50','XV70','3.5 V6'])}`, () => `Toyota Crown ${r(['Athlete','Majesta','S180'])}|jdm`,
                () => `Nissan Silvia ${r(['S13','S14','S15','Spec-R'])}|jdm`, () => `Nissan Skyline ${r(['R32','R33','R34','GTS-T'])}|jdm`,
                () => `Subaru Impreza ${r(['WRX STI','GC8','GD','GRB'])}|jdm`, () => `Honda Accord ${r(['CL7 Euro-R','CU2'])}`,
                () => `Kia K5 ${r(['GT-Line','2.5'])}`, () => `Geely Monjaro ${r(['Flagship','Exclusive'])}|china`,
                () => `Tank 300 ${r(['City','Offroad'])}`, () => `Haval F7x ${r(['Tech Plus','Premium'])}`
            ];
            parseRes(r(cars)(), res, 'jdm');
        } else if(t=='premium'){
            res.tier='premium'; res.tierName='ПРЕМИУМ'; res.css='b-pre'; res.tcss='c-pre';
            const cars = [
                () => `BMW M5 ${r(['F90','E60','F10','Competition','CS'])}|bmw`, () => `BMW 5-Series ${r(['530d','540i','G30','F10'])}`,
                () => `BMW X5 ${r(['M50d','40d','G05','F15'])}`, () => `BMW X5M ${r(['F85','F95','Competition'])}`,
                () => `Mercedes E-Class ${r(['E63 S','E200','W213','W212'])}|merc`, () => `Mercedes S-Class ${r(['W222','W223','S500','Maybach'])}`,
                () => `Mercedes G-Class ${r(['G63 AMG','G500','W463'])}|merc`, () => `Audi RS6 ${r(['C7','C8','Avant'])}|audi`,
                () => `Audi RS7 Sportback`, () => `Porsche Cayenne ${r(['Turbo','GTS','Coupe'])}|super`,
                () => `Zeekr 001 ${r(['YOU','FR','Performance'])}|china`, () => `Li_Auto L9 Ultra`
            ];
            parseRes(r(cars)(), res, 'bmw');
        } else if(t=='luxury'){
            res.tier='luxury'; res.tierName='ЛЮКС / ЭКЗОТИКА'; res.css='b-lux'; res.tcss='c-lux';
            const cars = [
                () => `Ferrari ${r(['488 Pista','SF90','812 Superfast','LaFerrari'])}|super`, 
                () => `Lamborghini ${r(['Urus','Aventador SVJ','Huracan STO','Revuelto'])}|super`,
                () => `Porsche 911 ${r(['Turbo S','GT3 RS','(992)'])}|super`, 
                () => `Rolls-Royce Cullinan Black_Badge`, 
                () => `Bugatti Chiron Super_Sport`, 
                () => `McLaren 765LT Coupe`, 
                () => `YangWang U9 Ultimate`
            ];
            parseRes(r(cars)(), res, 'super');
        } else {
            res.tier='matmall'; res.tierName='MAT-MALL'; res.css='b-mat'; res.tcss='c-mat';
            res.brand='Porsche'; res.model='Cayenne Coupe'; res.spec='Turbo GT'; res.tune='Mat-Mall Edition';
        }
        return res;
    }

    function parseRes(str, obj, defType) {
        let parts = str.split('|');
        let name = parts[0];
        let tuneType = parts[1] || defType;
        
        // Simple parse: Brand Model Spec
        let words = name.split(' ');
        obj.brand = words[0].replace('_', ' ');
        obj.model = words[1].replace('_', ' ');
        obj.spec = words.slice(2).join(' ');
        obj.tune = getTune(tuneType);
    }

    // --- STEP-BY-STEP ANIMATION ---
    async function spin() {
        const btn = el('spinBtn');
        if(btn.disabled) return;
        btn.disabled=true;
        
        el('googleBtn').classList.remove('visible');
        el('initialMsg').style.display='none';
        initAudio();

        // 1. Generate
        carData = generate();
        currentCar = `${carData.brand} ${carData.model} ${carData.spec} ${carData.tune||''}`;

        // 2. Prepare UI
        const box = el('box');
        const rows = ['stepTier','stepBrand','stepModel','stepSpec','stepTune'];
        
        // Reset Box Style
        box.className = 'output-box'; // Remove old colors
        
        // Hide all rows
        rows.forEach(id => {
            const row = el(id);
            row.classList.remove('visible');
            row.classList.add('hidden');
            row.innerText = '';
            row.className = 'step-row hidden'; // Reset colors
        });

        // 3. PLAY SEQUENCE
        // Step 1: Tier
        await wait(200);
        showRow('stepTier', carData.tierName);
        el('stepTier').classList.add(carData.tcss);
        beep(400); vib(20);

        // Step 2: Brand
        await wait(500);
        showRow('stepBrand', carData.brand);
        beep(500); vib(30);

        // Step 3: Model
        await wait(500);
        showRow('stepModel', carData.model);
        beep(600); vib(30);

        // Step 4: Spec
        await wait(500);
        showRow('stepSpec', carData.spec);
        beep(700); vib(30);

        // Step 5: Tune (Only if exists)
        await wait(500);
        let tuneTxt = carData.tune ? carData.tune : "STOCK";
        let tuneEl = el('stepTune');
        tuneEl.innerText = tuneTxt;
        tuneEl.classList.remove('hidden');
        
        if(!carData.tune) {
            tuneEl.style.opacity = 0.3; // Dim stock
            tuneEl.style.color = '#fff';
        } else {
            tuneEl.style.opacity = 1;
            tuneEl.style.color = 'var(--mat)';
        }
        
        // Trigger reflow for transition
        void tuneEl.offsetWidth;
        tuneEl.classList.add('visible');
        
        // Final Impact
        if(carData.tune) beep(900); 
        box.classList.add(carData.css); // Glow border
        vib([50,50,100]);

        // Enable Buttons
        await wait(200);
        el('spinBtn').disabled = false;
        el('googleBtn').classList.add('visible');
    }

    function showRow(id, text) {
        const row = el(id);
        row.innerText = text;
        row.classList.remove('hidden');
        void row.offsetWidth; // Force reflow
        row.classList.add('visible');
    }

    function openGoogle() {
        if(currentCar) window.open(`https://www.google.com/search?tbm=isch&q=${encodeURIComponent(currentCar)}`, '_blank');
    }
</script>
</body>
</html>
